{% extends "base.html" %}

{% block css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='settings.css') }}">
{% endblock %}

{% block content %}
<div class="settings-page">

  <h2 class="settings-title">{{ t('settings') }}</h2>

  <!-- ===== TABS ===== -->
  <div class="settings-tabs">
    <button class="tab-btn active" data-tab="profile">{{ t('profile') }}</button>
    <button class="tab-btn" data-tab="security">{{ t('security') }}</button>
    <button class="tab-btn" data-tab="preferences">{{ t('preferences') }}</button>

    {% if session.get('role') == 'admin' %}
      <button class="tab-btn" data-tab="admin">{{ t('administration') }}</button>
    {% endif %}
  </div>

  <!-- ===== PROFIL ===== -->
  <div class="tab-section" id="profile">
  <h3>Mon Profil</h3>

  <div class="profile-container-pro">
    <!-- Colonne gauche : Avatar et bienvenue -->
    <div class="profile-left">
      <div class="avatar-box">
        <img src="{{ url_for('static', filename='avatar.jpg') }}" alt="Avatar">
      </div>
      <h2>Salut, {{ session.get('username') }}</h2>
      <p>Bienvenue sur votre espace personnel</p>
    </div>

    <!-- Colonne droite : Infos -->
    <div class="profile-right">
      <div class="info-card">
        <i class="fa fa-user icon-card"></i>
        <div>
          <label>Nom d'utilisateur</label>
          <p>{{ session.get('username') }}</p>
        </div>
      </div>

      <div class="info-card">
        <i class="fa fa-envelope icon-card"></i>
        <div>
          <label>Email</label>
          <p>{{ session.get('email') }}</p>
        </div>
      </div>

      <div class="info-card">
        <i class="fa fa-shield icon-card"></i>
        <div>
          <label>R√¥le</label>
          <p>{{ session.get('role') }}</p>
        </div>
      </div>

      <div class="info-card">
        <i class="fa fa-calendar icon-card"></i>
        <div>
          <label>Date de cr√©ation</label>
          <p>{{ session.get('date_creation') }}</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Font Awesome pour les ic√¥nes -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- ===== SECURITY ===== -->
  <div class="tab-section" id="security">
  <h3>S√©curit√© du compte</h3>

  <form method="POST" action="{{ url_for('change_password') }}">

    <div class="form-group">
      <label for="current_password">Ancien mot de passe</label>
      <input 
        type="password" 
        id="current_password"
        name="current_password"
        required
      >
    </div>

    <div class="form-group">
      <label for="new_password">Nouveau mot de passe</label>
      <input 
        type="password" 
        id="new_password"
        name="new_password"
        required
      >
    </div>

    <div class="form-group">
      <label for="confirm_password">Confirmer le mot de passe</label>
      <input 
        type="password" 
        id="confirm_password"
        name="confirm_password"
        required
      >
    </div>

    <button type="submit" class="primary-btn">
      Modifier le mot de passe
    </button>

  </form>
</div>
  <!-- ===== PREFERENCES ===== -->
  <div class="tab-section" id="preferences">
    <h3>Pr√©f√©rences</h3>

    <form method="POST" action="{{ url_for('update_preferences') }}">

        <!-- LANGUE -->
        <div class="form-group">
            <label for="language">{{ t('language') }}</label>
            <select name="language" id="language">
                <option value="fr" {% if session.get('language') == 'fr' %}selected{% endif %}>
                    Fran√ßais
                </option>
                <option value="en" {% if session.get('language') == 'en' %}selected{% endif %}>
                    English
                </option>
            </select>
        </div>


        <!-- TH√àME -->
        <div class="form-group">
            <label for="theme">Th√®me</label>
            <select name="theme" id="theme">
                <option value="light" {% if session.get('theme') == 'light' %}selected{% endif %}>
                    Clair
                </option>
                <option value="dark" {% if session.get('theme') == 'dark' %}selected{% endif %}>
                    Sombre
                </option>
            </select>
        </div>

        <button type="submit" class="primary-btn">
            {{ t('save') }}
        </button>
    </form>
</div>
  <!-- ===== ADMIN ===== -->
    {% if session.get('role') == 'admin' %}
<div class="tab-section" id="admin">
  <h3>Administration avanc√©e</h3>

  <div class="admin-cards">
    <!-- Carte 1 : R√¥les actuels -->
    <div class="card">
        <h3>R√¥les actuels</h3>
        <p>{{ session.get('role') }}</p>
    </div>

    <!-- Carte 2 : √âtat du syst√®me -->
    <div class="card">
        <h3>√âtat du syst√®me</h3>
        <p class="status ok">üü¢ Fonctionnel</p>
    </div>

    <!-- Carte 3 : Derni√®res connexions -->
    <div class="card card-logins">
        <h3>Derni√®res connexions</h3>
        <table>
            <thead>
                <tr>
                    <th>Utilisateur</th>
                    <th>Email</th>
                    <th>R√¥le</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                {% for login in last_logins %}
                <tr>
                    <td>{{ login.UserName }}</td>
                    <td>{{ login.email }}</td>
                    <td>{{ login.role }}</td>
                    <td>{{ login.date_login }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4">Aucune connexion r√©cente.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}
{% endblock %}

{% block js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
  const tabs = document.querySelectorAll(".tab-btn");
  const sections = document.querySelectorAll(".tab-section");

  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(t => t.classList.remove("active"));
      sections.forEach(s => s.classList.remove("active"));

      tab.classList.add("active");
      document.getElementById(tab.dataset.tab).classList.add("active");
    });
  });
});
</script>
{% endblock %}