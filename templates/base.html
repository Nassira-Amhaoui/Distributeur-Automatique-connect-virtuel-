<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Distributeur</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://kit.fontawesome.com/a2d9d6a64d.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  {% block css %}{% endblock %}

</head>

<body class="{{ session.get('theme', 'light')}}">
<!-- Flash message -->
    <div class="flash-messages-container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message|safe }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
</div>
<div class="layout">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-box">DA</div>
            <span>Distributeur<br>Automatique</span>
          
        </div>

        <nav class="menu">
            <a href="{{ url_for('dashboard') }}" class="active"><i data-feather="home"></i> Dashboard</a>
            <a href="{{ url_for('produits') }}" 
                class="{% if active=='produits' %}active{% endif %}">
                <i data-feather="package"></i> Produits
            </a>

            <a href="{{ url_for('analytics') }}"><i data-feather="pie-chart"></i> Analytics</a>
            {% if session.get('role') == 'admin' %}
            <a href="{{ url_for('users') }}"><i data-feather="users"></i> Users</a>
            <a href="{{ url_for('settings') }}"><i data-feather="settings"></i> Settings</a>
            {% endif %}
            <!-- boutton logout -->
            <a href="{{ url_for('logout') }}"><i data-feather="logout"></i> Logout</a>
        
        </nav>



        <div class="user-box">
            <div class="avatar">AS</div>
            <div>
                <p class="name">{{ session.get('username') }}</p>
                <p class="email">{{ session.get('email') }} - {{ session.get('role') }}</p>
            </div>
        </div>
    </aside>

    <!-- Content area -->
    <main class="content">

        <!-- Top bar -->
        <header class="topbar">
            <div class="search">
                <i data-feather="search"></i>
                <input type="text" id="productSearch" placeholder="Search...">
            </div>
            
            <!-- Notification Panel -->
            <div id="notification-panel" class="notification-panel hidden">
                <h3>Notifications</h3>

                <ul>
                    <li>Aucun nouvelle notification.</li>
                </ul>
            </div>



            <div class="top-icons">
                <i data-feather="bell"></i>

                <!-- Toggle Light/Dark -->
                <label class="theme-toggle" id="themeToggle">
                    <input type="checkbox" id="themeCheckbox">
                    <span class="toggle-circle"></span>
                    <span class="icon sun">‚òÄÔ∏è</span>
                    <span class="icon moon">üåô</span>
                </label>


                <img src="https://via.placeholder.com/36" class="admin-img">
            </div>
        </header>
        <section class="page-content">
            {% block content %}{% endblock %}
        </section>
    </main>
</div>

<script>
feather.replace();

/* --- THEME TOGGLE FIXED --- */
const themeSwitch = document.querySelector("#themeToggle input");

themeSwitch.addEventListener("change", () => {
    document.body.classList.toggle("dark");
});
</script>
<script>
const searchInput = document.getElementById('productSearch');
const table = document.querySelector('.products-table tbody');
const rows = table.querySelectorAll('tr');

searchInput.addEventListener('input', function() {
    const filter = this.value.toLowerCase();

    let hasVisible = false;

    rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        let match = false;

        cells.forEach(cell => {
            if (cell.textContent.toLowerCase().includes(filter)) {
                match = true;
            }
        });

        if (match) {
            row.style.display = '';
            hasVisible = true;
        } else {
            row.style.display = 'none';
        }
    });

    // Afficher message ‚ÄúAucun produit trouv√©‚Äù si rien ne correspond
    let emptyRow = table.querySelector('.no-match');
    if (!hasVisible) {
        if (!emptyRow) {
            const tr = document.createElement('tr');
            tr.classList.add('no-match');
            tr.innerHTML = `<td colspan="4" style="text-align:center; padding:20px;">Aucun produit trouv√©.</td>`;
            table.appendChild(tr);
        }
    } else {
        if (emptyRow) emptyRow.remove();
    }
});
</script>
<script>
feather.replace(); // Tr√®s important

// R√©cup√©rer le SVG g√©n√©r√© par Feather
const bellIcon = document.querySelector('.top-icons svg.feather-bell');
const notifPanel = document.getElementById("notification-panel");

// Toggle du panneau
bellIcon.addEventListener("click", (e) => {
    e.stopPropagation(); // emp√™cher la fermeture instantan√©e
    notifPanel.classList.toggle("hidden");
});

// Fermer en cliquant ailleurs
document.addEventListener("click", (e) => {
    if (!notifPanel.contains(e.target) && e.target !== bellIcon) {
        notifPanel.classList.add("hidden");
    }
});
</script>
<script>
setTimeout(() => {
    document.querySelectorAll('.flash').forEach(flash => {
        flash.style.opacity = '0';
        setTimeout(() => flash.remove(), 400);
    });
}, 4000);
</script>

{% block js %}{% endblock %}
</body>
</html>
