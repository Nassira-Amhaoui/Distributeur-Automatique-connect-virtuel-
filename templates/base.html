<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Distributeur</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://kit.fontawesome.com/a2d9d6a64d.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/feather-icons"></script>

</head>

<body>

<div class="layout">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-box">DA</div>
            <span>Distributeur<br>Automatique</span>
          
        </div>

        <nav class="menu">
            <a href="{{ url_for('dashboard') }}" class="{% if active=='dashboard' %}active{% endif %}">
                <i data-feather="home"></i> Dashboard
            </a>
            <a href="{{ url_for('produits') }}" class="{% if active=='produits' %}active{% endif %}">
                <i data-feather="package"></i> Produits
            </a>
            <a href="{{ url_for('product_history') }}" class="{% if active=='product_history' %}active{% endif %}">
                <i data-feather="pie-chart"></i> Analytics
            </a>
            <a href="{{ url_for('users') }}" class="{% if active=='users' %}active{% endif %}">
                <i data-feather="users"></i> Users
            </a>
            <a href="{{ url_for('settings') }}" class="{% if active=='settings' %}active{% endif %}">
                <i data-feather="settings"></i> Settings
            </a>
        </nav>




        <div class="user-box">
            <div class="avatar">AS</div>
            <div>
                <p class="name">Admin User</p>
                <p class="email">admin@example.com</p>
            </div>
        </div>
    </aside>

    <!-- Content area -->
    <main class="content">

        <!-- Top bar -->
        <header class="topbar">
            <div class="search">
                <i data-feather="search"></i>
                <input type="text" id="productSearch" placeholder="Search...">
            </div>
           

        <div class="top-icons">
           <div class="notification-wrapper" style="position: relative;" data-count="{{ produits_faible|length }}">
                <i data-feather="bell" id="bell-icon"></i>
                <span id="notif-badge" class="notif-badge"></span>

                <div id="notification-panel" class="notification-panel hidden">
                    <h3>Notifications</h3>
                    <ul>
                        {% if produits_faible %}
                            {% for p in produits_faible %}
                                <li>‚ö†Ô∏è {{ p.Nom }} est presque √©puis√© ({{ p.Quantite }})</li>
                            {% endfor %}
                        {% else %}
                            <li>Aucune nouvelle notification.</li>
                        {% endif %}
                    </ul>
                </div>
            </div>


            <!-- Toggle Light/Dark -->
            <label class="theme-toggle" id="themeToggle">
                <input type="checkbox" id="themeCheckbox">
                <span class="toggle-circle"></span>
                <span class="icon sun">‚òÄÔ∏è</span>
                <span class="icon moon">üåô</span>
            </label>

            <img src="https://via.placeholder.com/36" class="admin-img">
        </div>

        </header>

        <section class="page-content">
            {% block content %}{% endblock %}
        </section>
    </main>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
    const menuItems = document.querySelectorAll('.menu a');

    menuItems.forEach(item => {
        item.addEventListener('click', function(e) {
            // Supprimer "selected" de tous les √©l√©ments
            menuItems.forEach(i => i.classList.remove('selected'));

            // Ajouter "selected" √† l'√©l√©ment cliqu√©
            this.classList.add('selected');
        });
    });
});

</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    // Remplacer les ic√¥nes Feather
    feather.replace();

    // Notifications
    const bellWrapper = document.querySelector('.notification-wrapper');
    const bellIcon = bellWrapper.querySelector('svg');
    const notifPanel = document.getElementById("notification-panel");
    const notifBadge = document.getElementById("notif-badge");

    const notifWrapper = document.getElementById("notif-wrapper");

    let count = parseInt(bellWrapper.dataset.count) || 0;

    if(count > 0){
        notifBadge.textContent = count;
        notifBadge.style.display = "flex"; // centr√©
    } else {
        notifBadge.style.display = "none";
    }

     // Toggle affichage panel notifications
    if(bellIcon){
        bellIcon.addEventListener("click", (e) => {
            e.stopPropagation();
            notifPanel.classList.toggle("show"); // <-- ici on toggle "show"
            notifBadge.style.display = "none";   // cache le badge quand ouvert
        });
    }

    // Clic en dehors pour fermer le panel
    document.addEventListener("click", (e) => {
        if (!notifPanel.contains(e.target) && e.target !== bellIcon) {
            notifPanel.classList.remove("show"); // retire "show"
        }
    });


    // Theme toggle
    const themeSwitch = document.getElementById("themeCheckbox");
    themeSwitch.addEventListener("change", () => {
        document.body.classList.toggle("dark");
    });
 // Theme toggle
   
    // Recherche produit (si tableau existe)
    const searchInput = document.getElementById('productSearch');
    const table = document.querySelector('.products-table tbody');
    if(table){
        const rows = table.querySelectorAll('tr');
        searchInput.addEventListener('input', function() {
            const filter = this.value.toLowerCase();
            let hasVisible = false;

            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                let match = false;
                cells.forEach(cell => {
                    if(cell.textContent.toLowerCase().includes(filter)){
                        match = true;
                    }
                });
                row.style.display = match ? '' : 'none';
                if(match) hasVisible = true;
            });

            let emptyRow = table.querySelector('.no-match');
            if(!hasVisible){
                if(!emptyRow){
                    const tr = document.createElement('tr');
                    tr.classList.add('no-match');
                    tr.innerHTML = `<td colspan="4">Aucun produit trouv√©.</td>`;
                    table.appendChild(tr);
                }
            } else {
                if(emptyRow) emptyRow.remove();
            }
        });
    }
});
</script>


</body>
</html>
